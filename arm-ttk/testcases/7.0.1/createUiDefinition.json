{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "resourceTypes": [
      "microsoft.resources/resourcegroups"
    ],
    "basics": [
      {
        "name": "sites_BETemplate_name",
        "type": "Microsoft.Common.TextBox",
        "label": "Site Name",
        "subLabel": "The name of the site. Will become sitename.azurewebsites.net",
        "toolTip": "Lowercase letters and digits only (3-21 chars). A storage account name will be derived as <site>stg.",
        "constraints": {
          "required": true,
          "regex": "^[a-z0-9]{3,21}$",
          "validationMessage": "Use 3-21 lowercase letters or digits. (We derive a 24-char storage name by adding 'stg'.)"
        },
        "visible": true
      },
      {
        "name": "serverfarms_BETemplatePlan_name",
        "type": "Microsoft.Common.TextBox",
        "label": "Server Plan Name",
        "subLabel": "The Name for the Server Plan",
        "toolTip": "The Name for the Server Farm Plan",
        "constraints": {
          "required": true,
          "regex": "^[a-zA-Z0-9-]{1,30}$",
          "validationMessage": "Please re-enter a valid server plan name"
        },
        "visible": true
      },
      {
        "name": "managedIdentityName",
        "type": "Microsoft.ManagedIdentity.IdentitySelector",
        "label": "Managed Identity Configuration",
        "toolTip": {
          "systemAssignedIdentity": "Enable system assigned identity to grant the resource access to other existing resources.",
          "userAssignedIdentity": "Add user assigned identities to grant the resource access to other existing resources."
        },
        "defaultValue": {
          "systemAssignedIdentity": "Off"
        },
        "options": {
          "hideSystemAssignedIdentity": true,
          "hideUserAssignedIdentity": false
        },
        "visible": true
      },
      {
        "name": "entraId_Application_ClientName",
        "type": "Microsoft.Common.TextBox",
        "label": "EntraId Application Client Name",
        "subLabel": "The name of the new client application in EntraId",
        "toolTip": "The name of the World of Workflows Client Entra Id Application",
        "constraints": {
          "required": true,
          "regex": "^[a-zA-Z0-9]{1,30}$",
          "validationMessage": "Please enter a valid name for the Entra Id Client Application"
        },
        "visible": true
      },
      {
        "name": "entraId_Application_ServerName",
        "type": "Microsoft.Common.TextBox",
        "label": "EntraId Application Server Name",
        "subLabel": "The name of the new server application in EntraId",
        "toolTip": "The name of the World of Workflows Server Entra Id Application",
        "constraints": {
          "required": true,
          "regex": "^[a-zA-Z0-9]{1,30}$",
          "validationMessage": "Please enter a valid name for the EntraId Server Application"
        },
        "visible": true
      },
      {
        "name": "storageAccounts_wowtemplatestorage_name",
        "type": "Microsoft.Common.TextBox",
        "label": "Storage Account",
        "visible": false,
        "toolTip": "Hidden: derived from Site Name as lowercase <site>stg. Must be 3-24 lowercase letters or digits.",
        "constraints": {
          "required": true,
          "regex": "^[a-z0-9]{3,24}$",
          "validationMessage": "Derived storage account name must be 3-24 lowercase letters or digits."
        }
      }
    ],
    "steps": [],
    "outputs": {
      "sites_BETemplate_name": "[basics('sites_BETemplate_name')]",
      "serverfarms_BETemplatePlan_name": "[basics('serverfarms_BETemplatePlan_name')]",
      "managedIdentityName": "[basics('managedIdentityName')]",
      "managedIdentity": "[basics('managedIdentityName')]",
      "storageAccounts_wowtemplatestorage_name": "[toLower(substring(concat(replace(basics('sites_BETemplate_name'), '-', ''), 'stg'), 0, 24))]",
      "entraId_Application_ClientName": "[basics('entraId_Application_ClientName')]",
      "entraId_Application_ServerName": "[basics('entraId_Application_ServerName')]",
      "location": "[location()]"
    }
  }
}